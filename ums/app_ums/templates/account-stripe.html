{% extends "base.html" %}


{% block pagestyles %}
<link href="{{ url_for('static', filename='global.css') }}" rel="stylesheet" type="text/css">
<link href="{{ url_for('static', filename='normalize.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block content %}
<div>
  <h1>{{ body }}</h1>
</div>
<div class="form-wrapper">

  <!-- <div class="logo">
    <img src="{{ url_for('static', filename='dist/img/logo.png') }}" alt="logo"/>
  </div> -->
    <input type="hidden" id="subscriptionId_hidden" value = "{{ data.subscriptionId }}">
    <input type="hidden" id="priceId_hidden" value = "{{ data.priceId }}">
    <input type="hidden" id="currentPeriodEnd_hidden" value = "{{ data.currentPeriodEnd }}">
    <input type="hidden" id="customerId_hidden" value = "{{ data.customerId }}">
    <input type="hidden" id="paymentMethodId_hidden" value = "{{ data.paymentMethodId }}">
    <input type="hidden" name="csrf_token" id="csrf_token" value="{{ csrf_token() }}" />
  <script type="text/javascript">
    var subscriptionId = document.querySelector('#subscriptionId_hidden').value;
    var priceId = document.querySelector('#priceId_hidden').value;
    var currentPeriodEnd = document.querySelector('#currentPeriodEnd_hidden').value;
    var customerId = document.querySelector('#customerId_hidden').value;
    var paymentMethodId = document.querySelector('#paymentMethodId_hidden').value;
  </script>
  
  <script src="https://js.stripe.com/v3/"></script>
  <script src="{{ url_for('static', filename='stripe-jsfiles.js') }}"></script>

  <nav class="flex items-center justify-between flex-wrap">
    <div>
      <button
        class="bg-white hover:bg-white hover:shadow-outline hover:text-pasha hover:border hover:border-black focus:shadow-outline text-pasha focus:bg-white focus:text-pasha font-light py-2 px-4 rounded"
        type="button"
        onclick="window.location.href='/'"
      >
        Sign out
      </button>
    </div>
  </nav>
  <div id="subscription-cancelled" class="hidden">
    <div class="flex flex-wrap font-bold text-pasha text-xl mt-6 mb-2">
      Subscription canceled
    </div>
    <div>
      <button
        class="bg-pasha hover:bg-white hover:shadow-outline hover:text-pasha hover:border hover:border-black focus:shadow-outline text-white focus:bg-white focus:text-pasha font-light py-2 px-4 rounded"
        type="button"
        onclick="window.location.href='/'"
      >
        Restart demo
      </button>
    </div>
  </div>
  <div id="subscription-settings">
    <div class="flex flex-wrap justify-center mt-4">
      <div class="md:w-2/5 w-full inline-block rounded-md p-4">
        <div
          id="subscription-status-text"
          class="text-center font-bold text-pasha text-2xl"
        >
          Account settings
        </div>
        <div class="mt-4 border rounded p-4">
          <div class="font-bold text-xl mb-2">
            Account
          </div>
          <div class="flex justify-between text-gray-600 text-xl">
            <div>Current price</div>
            <div
              class="font-bold text-xl"
              id="subscribed-price"
              class="mb-2"
            ></div>
          </div>

          <div class="flex justify-between">
            <div class="text-xl text-gray-600">
              Credit card
            </div>
            <span
              id="credit-card-last-four"
              class="font-bold text-xl text-gray-600"
            ></span>
          </div>

          <div
            class="flex justify-between mt-2 mb-2 text-gray-900 font-bold text-xl cursor-pointer"
            onClick="changePrice()"
          >
            <span>Change pricing plan <span>→</span></span>
          </div>
          <div
            class="flex justify-between mt-2 mb-2 text-gray-900 font-bold text-xl cursor-pointer"
            onClick="cancelSubscription()"
          >
            <span>Cancel subscription <span>→</span></span>
          </div>
        </div>

        <div id="prices-form" class="w-full mr-4 md:mb-8 hidden">
          <div class="text-center text-pasha font-bold text-2xl mt-4 mb-6">
            Change pricing plan
          </div>

          <div class="flex justify-between mb-8">
            <div
              id="basic"
              class="w-1/2 rounded overflow-hidden border rounded-md p-2 mr-4 md:mr-8"
            >
              <div class="px-2 py-2">
                <div class="text-gray-500 text-xl mb-2 font-medium">
                  Basic
                </div>
                <p class="text-pasha text-2xl font-extrabold">
                  $5.00
                </p>
                <div class="flex-wrap">
                  <div class="leading-none text-gray-500 text-xs font-medium">
                    Per month
                  </div>
                  <div
                    class="leading-none text-gray-500 text-xs font-medium mt-1"
                  >
                    Billed monthly
                  </div>
                </div>

                <div class="flex justify-center mt-6">
                  <button
                    id="submit-basic"
                    onClick="switchPrices('BASIC')"
                    class="bg-pasha hover:bg-white outline-none hover:text-pasha hover:border hover:border-black text-white focus:bg-white focus:text-pasha font-light py-2 px-4 rounded-lg"
                    type="submit"
                  >
                    <div
                      id="submit-basic-button-text"
                      class="w-auto -mx-2 md:mx-0"
                    >
                      <div id="loading" class=""></div>
                      <span id="button-text">Select</span>
                    </div>
                  </button>
                </div>
              </div>
            </div>
            <div
              id="premium"
              class="w-1/2 rounded overflow-hidden border rounded-md p-2"
            >
              <div class="px-2 py-2">
                <div class="text-gray-500 text-xl mb-2 font-medium">
                  Premium
                </div>
                <p class="text-pasha text-2xl font-extrabold">
                  $15.00
                </p>
                <div class="flex-wrap">
                  <div class="leading-none text-gray-500 text-xs font-medium">
                    Per month
                  </div>
                  <div
                    class="leading-none text-gray-500 text-xs font-medium mt-1"
                  >
                    Billed monthly
                  </div>
                </div>
                <div class="flex justify-center mt-6">
                  <button
                    id="submit-premium"
                    onClick="switchPrices('PREMIUM')"
                    class="bg-pasha hover:bg-white outline-none hover:text-pasha hover:border hover:border-black text-white focus:bg-white focus:text-pasha font-light py-2 px-4 rounded-lg"
                    type="submit"
                  >
                    <div
                      id="submit-premium-button-text"
                      class="w-auto -mx-2 md:mx-0"
                    >
                      <div id="loading" class=""></div>
                      <span id="button-text">Select</span>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div id="price-change-form" class="flex justify-center">
            <div
              class="w-full rounded overflow-hidden border rounded-md p-4 mb-4"
            >
              <div class="flex justify-between text-gray-600 text-m">
                <div>Current price</div>
                <div
                  class="font-bold text-m"
                  id="current-price-subscribed"
                  class="mb-2"
                ></div>
              </div>

              <div class="flex justify-between text-gray-600 text-m">
                <div>New price</div>
                <div
                  class="font-bold text-m"
                  id="new-price-selected"
                  class="mb-2"
                ></div>
              </div>

              <div>
                <p class="mt-4 mb-4 text-gray-600">
                  You will be charged
                  <span id="new-price-price-selected"></span>
                  on <span id="new-price-start-date"></span>
                </p>
                <button
                  id="confirm-price-change-submit"
                  onClick="confirmPriceChange()"
                  class="bg-pasha hover:bg-white hover:shadow-outline hover:text-pasha hover:border hover:border-black focus:shadow-outline text-white focus:bg-white focus:text-pasha font-light py-2 px-4 rounded-lg"
                  type="submit"
                >
                  <div class="w-auto -mx-2 md:mx-0">
                    <div id="loading" class=""></div>
                    <span id="button-text">Confirm change</span>
                  </div>
                </button>
                <button
                  id="confirm-price-change-cancel"
                  onClick="cancelChangePrice()"
                  class="bg-pasha hover:bg-white hover:shadow-outline hover:text-pasha hover:border hover:border-black focus:shadow-outline text-white focus:bg-white focus:text-pasha font-light py-2 px-4 rounded-lg"
                  type="submit"
                >
                  <div class="w-auto -mx-2 md:mx-0">
                    <div id="loading" class=""></div>
                    <span id="button-text">Cancel</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
